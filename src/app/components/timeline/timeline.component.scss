@use 'styles/util/mixins' as u;

/* Container */
.timeline-container {
  background: linear-gradient(135deg, var(--color-surface) 0%, var(--color-canvas) 100%);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md, 8px);
  overflow: hidden;
  font-family: var(--font-sans, Arial, sans-serif);
  box-shadow: var(--shadow-1);
}

/* Controls row */
.timeline-controls {
  display: flex; justify-content: space-between; align-items: center;
  padding: 1rem;
  background: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  color: var(--color-text);
}
.timeline-navigation {
  display: flex; align-items: center; gap: .5rem;
}
.nav-btn {
  display: inline-flex; align-items: center; justify-content: center;
  width: 32px; height: 32px;
  border: 1px solid var(--color-border);
  background: var(--color-surface);
  border-radius: var(--radius-sm, 6px);
  cursor: pointer;
  transition: background-color .2s ease, border-color .2s ease, box-shadow .2s ease;
  @include u.interactive-states;

  &:hover {
    background: var(--color-surface-hover);
    border-color: color-mix(in oklab, var(--color-primary) 50%, var(--color-border));
    box-shadow: var(--shadow-1);
  }
}
.date-range {
  display: inline-flex; align-items: center; gap: .5rem; margin-left: 1rem;
  font-weight: var(--fw-semibold, 600); color: var(--color-text);
}

/* Legend */
.timeline-legend {
  display: flex; flex-wrap: wrap; align-items: center;
  gap: clamp(.4rem, 1.2cqi, 1.2rem);
  font-size: clamp(.85rem, .6cqi + .7rem, 1rem);
  color: var(--color-text);
}
.legend-item { display: inline-flex; align-items: center; gap: .5rem; font-size: .875rem; }
.legend-color {
  width: 12px; height: 12px; border-radius: 2px; border: 1px solid var(--color-border);
}
.legend-color.critical {
  border-width: 2px !important;
}
.legend-active {
  background-color: var(--color-primary);
}
.legend-completed {
  background-color: var(--gray-600);
}
.legend-pending {
  background-color: var(--color-surface-subtle);
}
.legend-behind {
  background: linear-gradient(135deg,
    color-mix(in oklab, var(--color-warning) 70%, transparent) 0%,
    color-mix(in oklab, var(--color-danger) 85%, transparent) 100%);
}
.legend-critical {
  background-color: var(--color-primary);
  border-left: 2px solid var(--color-danger);
}

/* Header (weeks + days) */
.timeline-header {
  display: flex;
  background: var(--color-primary);
  border-bottom: 2px solid var(--color-border);
  color: var(--color-text-inverse);
}
.week-cell {
  flex: 1; min-width: 140px;
}
.week-cell.current-week {
  background: color-mix(in oklab, var(--color-primary) 25%, transparent);
}
.week-label {
  padding: .5rem;
  font-weight: var(--fw-bold, 700);
  color: var(--color-text-inverse);
  text-align: center;
  border-bottom: 1px solid color-mix(in oklab, var(--color-border) 50%, transparent);
}
.week-days { display: flex; }
.day-cell {
  flex: 1; min-width: 20px; padding: .25rem 0; text-align: center;
  font-size: .8rem; color: var(--color-text-inverse);
  border-right: 1px solid color-mix(in oklab, var(--color-border) 40%, transparent);
}
.day-cell.weekend {
  background: color-mix(in oklab, var(--color-text) 8%, transparent);
}
.day-cell.today {
  background: var(--color-text-inverse);
  color: var(--color-primary);
  font-weight: var(--fw-bold, 700);
}

/* Grid */
.timeline-grid {
  position: relative;
  overflow: hidden;
  background: var(--color-surface);
  color: var(--color-text);
}
.grid-background {
  display: flex;
  position: absolute; inset: 0;
  height: 100%;
}
.week-grid {
  flex: 1; min-width: 0;
  border-right: 1px solid color-mix(in oklab, var(--color-border) 60%, transparent);
  display: flex;
}
.week-grid.current-week-bg {
  background: color-mix(in oklab, var(--color-primary) 8%, transparent);
}
.day-grid {
  flex: 1; height: 100%;
  border-right: 1px solid color-mix(in oklab, var(--color-border) 50%, transparent);
}
.day-grid.weekend-bg { background: color-mix(in oklab, var(--color-text) 4%, transparent); }
.day-grid.today-bg   { background: color-mix(in oklab, var(--color-primary) 14%, transparent); }

/* Task group bars */
.task-group-bar {
  position: absolute;
  height: 48px;
  background: var(--color-primary);
  border-radius: 6px;
  box-shadow: 0 2px 8px color-mix(in oklab, var(--color-primary) 18%, transparent);
  cursor: pointer;
  transition: transform .25s cubic-bezier(.4,0,.2,1), box-shadow .25s ease, background-color .25s ease, border-color .25s ease;
  border: 1px solid color-mix(in oklab, var(--color-primary) 65%, var(--color-border));
  overflow: hidden; z-index: 3; margin: 4px 0;

  &:hover {
    background: var(--color-primary);
    border-color: var(--color-primary-hover);
    box-shadow: 0 6px 16px color-mix(in oklab, var(--color-primary) 32%, transparent);
    transform: translateY(-2px) scale(1.02);
  }

  &.critical {
    border-left: 4px solid var(--color-danger);
    box-shadow: 0 2px 8px color-mix(in oklab, var(--color-danger) 25%, transparent);
  }

  &.dragging-source {
    opacity: .45; border-style: dashed;
  }

  &.status-completed {
    background: var(--gray-600);
    border-color: var(--gray-700);
    color: var(--color-text);
  }
  &.status-pending {
    background: var(--color-surface-subtle);
    border-color: var(--color-border);
    color: var(--color-text-white) !important;
    .task-name, .task-duration, .task-count, .progress-pill {
      color: var(--color-text) !important;
    }
  }
  &.status-delayed,
  &.schedule-status-behind {
    background: linear-gradient(135deg,
                  color-mix(in oklab, var(--color-warning) 70%, transparent) 0%,
                  color-mix(in oklab, var(--color-danger) 85%, transparent) 100%);
    border-color: var(--color-danger);
    color: var(--color-text);
  }
}

/* Drag ghost */
.group-ghost {
  position: fixed; pointer-events: none; z-index: 9999; opacity: .9;
  box-shadow: 0 8px 25px rgba(0,0,0,.25);
  transform: rotate(.5deg) scale(1.03);
}

/* Task bar content */
.task-content {
  display: flex; flex-direction: column; justify-content: center;
  padding: 0 .75rem; height: 100%;
  color: var(--color-text-inverse);
  position: relative; z-index: 2;
}
.task-meta {
  position: absolute; top: 50%; right: 12px; transform: translateY(-50%);
  display: inline-flex; align-items: center; gap: 8px; z-index: 3;
}
.weather-warning-icon {
  font-size: 1.1rem; cursor: help; color: var(--color-warning);
  text-shadow: 0 1px 2px rgba(0,0,0,.2);
}
.progress-pill {
  background: rgba(0,0,0,.22);
  color: var(--color-text-inverse);
  padding: 2px 8px; border-radius: 12px; font-size: .75rem; font-weight: 600;
  text-shadow: 0 1px 1px rgba(0,0,0,.4);
}
.task-name {
  font-weight: 700; font-size: .875rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.2; color: var(--color-text-inverse);
  text-shadow: 0 1px 2px rgba(0,0,0,.25);
}
.task-duration,
.task-count {
  font-size: .8rem; line-height: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--color-text-inverse);
  text-shadow: 0 1px 2px rgba(0,0,0,.25);
}

/* Inline progress */
.progress-bar {
  position: absolute; left: 2px; right: 2px; bottom: 2px; height: 4px;
  background: rgba(255,255,255,.25);
  border-radius: 2px;
}
.progress-fill {
  height: 100%;
  background: rgba(255,255,255,.9);
  border-radius: 2px;
  transition: width .25s ease;
}

/* Today marker */
.today-line {
  position: absolute; top: 0; bottom: 0; width: 2px;
  background: color-mix(in oklab, var(--color-text) 70%, transparent);
  z-index: 5;
  box-shadow: 0 0 4px color-mix(in oklab, var(--color-surface) 40%, transparent);
}

/* Modal (group details) */
.group-modal {
  background: var(--color-surface);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-3);
  max-width: 600px; width: 100%; max-height: 80vh;
  overflow: hidden; display: flex; flex-direction: column; color: var(--color-text);
}
.modal-header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 1.5rem; border-bottom: 1px solid var(--color-border);
  background: var(--color-surface-subtle);
}
.modal-header h2 {
  margin: 0; font-size: 1.25rem; font-weight: 700; color: var(--color-text);
}
.close-btn {
  background: none; border: 0; font-size: 1.5rem; cursor: pointer; color: var(--color-text-muted);
  padding: .25rem; border-radius: 4px; width: 32px; height: 32px; display: grid; place-items: center;
  &:hover { background: var(--color-surface-hover); color: var(--color-text); }
}
.modal-content {
  padding: 1.5rem; overflow-y: auto; flex: 1;
  h3 {
    margin: 0 0 1rem 0; font-size: 1.125rem; font-weight: 700; color: var(--color-text);
    display: inline-flex; align-items: center; gap: .5rem;
  }
}
.group-info {
  background: linear-gradient(135deg, var(--color-canvas) 0%, var(--color-surface-subtle) 100%);
  padding: 1.25rem; border-radius: var(--radius-md); margin-bottom: 1.5rem;
  border: 1px solid var(--color-border); box-shadow: var(--shadow-1);

  .info-item {
    margin-bottom: .75rem; font-size: .875rem; display: inline-flex; align-items: center; gap: .5rem;
    &:last-child { margin-bottom: 0; }
    strong { min-width: 80px; color: var(--color-text); }
  }
}
.status-on-track { color: var(--color-success);  font-weight: 600; }
.status-behind   { color: var(--color-danger);   font-weight: 600; }
.status-ahead    { color: var(--color-focus);    font-weight: 600; }

.subtasks-list { /* wrapper hook */ }
.subtask-item {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  padding: 1rem; margin-bottom: .75rem;
  transition: background-color .2s ease, border-color .2s ease, box-shadow .2s ease;

  &:hover { box-shadow: var(--shadow-1); border-color: color-mix(in oklab, var(--color-border) 70%, transparent); }
  &.completed { background: color-mix(in oklab, var(--color-success) 12%, transparent); border-color: color-mix(in oklab, var(--color-success) 40%, var(--color-border)); }
  &.critical { border-left: 4px solid var(--color-danger); }
}
.subtask-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: .5rem; }
.subtask-name   { font-weight: 600; color: var(--color-text); }
.subtask-status {
  background: var(--color-surface-subtle);
  color: var(--color-text);
  padding: .25rem .5rem; border-radius: 4px; font-size: .75rem; text-transform: capitalize; border: 1px solid var(--color-border);
}
.subtask-details {
  display: flex; gap: 1rem; margin-bottom: .5rem; font-size: .875rem; color: var(--color-text-muted); align-items: center;
  .duration, .dates { display: inline-flex; align-items: center; gap: .25rem; }
  mat-icon { font-size: 16px; width: 16px; height: 16px; }
}
.subtask-progress { display: flex; align-items: center; gap: .5rem; }
.progress-bar-small {
  flex: 1; height: 6px; background: var(--color-border); border-radius: 3px; overflow: hidden;
}
.progress-fill-small {
  height: 100%; background: var(--color-success); border-radius: 3px; transition: width .25s ease;
}
.modal-actions {
  display: flex; justify-content: flex-end; gap: .75rem;
  padding: 1.5rem; border-top: 1px solid var(--color-border); background: var(--color-surface-subtle);
}
.btn {
  padding: .5rem 1rem; border-radius: 6px; font-weight: 600; font-size: .875rem; cursor: pointer;
  transition: background-color .2s ease, border-color .2s ease, color .2s ease, box-shadow .2s ease;
  border: 1px solid transparent;
}
.btn-secondary {
  background: var(--color-surface); color: var(--color-text); border-color: var(--color-border);
  &:hover { background: var(--color-surface-hover); border-color: color-mix(in oklab, var(--color-border) 70%, transparent); }
}
.btn-primary {
  background: var(--color-primary); color: var(--color-text-inverse);
  &:hover { background: var(--color-primary-hover); }
}

/* Angular Material dialog wrapper */
::ng-deep .custom-modal-panel .mat-mdc-dialog-container {
  padding: 0 !important;
  border-radius: var(--radius-md) !important;
  overflow: hidden !important;
  background: var(--color-surface);
}

/* Status badges (list chips) */
.status-badge-pending   { background: color-mix(in oklab, var(--color-warning) 20%, transparent); color: var(--color-text-white); }
.status-badge-in_progress { background: color-mix(in oklab, var(--color-focus) 18%, transparent);   color: color-mix(in oklab, var(--color-focus) 70%, var(--color-text)); }
.status-badge-completed { background: color-mix(in oklab, var(--color-success) 18%, transparent);  color: color-mix(in oklab, var(--color-success) 70%, var(--color-text)); }
.status-badge-delayed   { background: color-mix(in oklab, var(--color-danger) 18%, transparent);   color: color-mix(in oklab, var(--color-danger) 70%, var(--color-text)); }

/* Weather callout */
.subtask-weather-warning {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 8px; background: color-mix(in oklab, var(--color-warning) 15%, transparent);
  border: 1px solid color-mix(in oklab, var(--color-warning) 45%, var(--color-border));
  border-radius: 4px; margin-top: 8px; font-size: .875rem; color: color-mix(in oklab, var(--color-warning) 60%, var(--color-text));
}
.weather-icon { width: 24px; height: 24px; }

/* Today/legend responsive container queries */
@container timeline (max-width: 480px) { .timeline-legend { gap: .5rem; } }
@container timeline (min-width: 900px) { .timeline-legend { gap: 1.5rem; } }

/* Motion preferences */
@media (prefers-reduced-motion: reduce) {
  * { transition: none !important; animation: none !important; }
}
