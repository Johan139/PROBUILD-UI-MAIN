<!-- PAGE WRAPPER -->
<div class="page-wrapper">
  <!-- Loader -->
  <div *ngIf="isLoading" class="loading-container">
    <app-loader aria-label="Loading content"></app-loader>
  </div>

  <!-- AUTHENTICATED LAYOUT -->
  <ng-container *ngIf="loggedIn; else publicLayout">
    <!-- Header -->
    <mat-toolbar class="header" role="banner">
      <button
        mat-icon-button
        (click)="sidenav.toggle()"
        aria-label="Toggle navigation menu"
      >
        <mat-icon>menu</mat-icon>
      </button>

      <a
        routerLink="/dashboard"
        class="logo-link"
        aria-label="ProBuild AI Home"
      >
        <img
          ngSrc="assets/logo.png"
          alt="Company Logo"
          height="52"
          width="152.5"
        />
      </a>

      <span class="spacer"></span>

      <app-notifications-menu></app-notifications-menu>

      <button
        mat-icon-button
        [matMenuTriggerFor]="userMenu"
        aria-label="Open user menu"
      >
        <mat-icon>settings</mat-icon>
      </button>
    </mat-toolbar>

    <!-- Company Name Bar -->
    <div *ngIf="companyName" class="company-bar">
      <span>{{ companyName }}</span>
    </div>

    <!-- SIDENAV LAYOUT -->
    <mat-sidenav-container class="nav-container">
      <mat-sidenav
        #sidenav
        mode="side"
        [opened]="isSidenavOpen"
        class="sidenav"
        [class.is-collapsed]="isSidenavOpen"
        role="navigation"
        aria-label="Primary"
      >
        <mat-nav-list class="nav-list" [disableRipple]="true">
          <a
            mat-list-item
            [disableRipple]="true"
            class="nav-item"
            *ngFor="let item of navItems"
            [routerLink]="item.route"
            (click)="item.action?.()"
            [routerLinkActive]="'is-active'"
            [matTooltip]="item.tooltip"
            matTooltipShowDelay="500"
            matTooltipPosition="right"
          >
            <span class="active-indicator"></span>
            <mat-icon matListItemIcon class="nav-icon">{{
              item.icon
            }}</mat-icon>
            <div matListItemTitle class="nav-label">{{ item.label }}</div>
          </a>
        </mat-nav-list>
      </mat-sidenav>

      <mat-sidenav-content>
        <div class="content-shell">
          <router-outlet *ngIf="isRouterOutletVisible"></router-outlet>
          <div class="flex-spacer"></div>
          <app-footer *ngIf="showFooter"></app-footer>
        </div>
      </mat-sidenav-content>
    </mat-sidenav-container>
  </ng-container>

  <!-- PUBLIC (LOGGED OUT) LAYOUT -->
  <ng-template #publicLayout>
    <mat-toolbar class="header" role="banner">
      <a routerLink="/login" class="logo-link" aria-label="ProBuild AI Home">
        <img
          ngSrc="assets/logo.png"
          alt="Company Logo"
          height="52"
          width="152.5"
        />
      </a>

      <span class="spacer"></span>

      <button
        mat-icon-button
        [matMenuTriggerFor]="guestMenu"
        aria-label="Open settings menu"
      >
        <mat-icon>settings</mat-icon>
      </button>
    </mat-toolbar>

    <router-outlet></router-outlet>
    <app-footer *ngIf="showFooter"></app-footer>
  </ng-template>
</div>

<!-- MENUS -->
<mat-menu #userMenu="matMenu">
  <button mat-menu-item routerLink="/profile">
    <mat-icon>person</mat-icon>Profile
  </button>
  <button mat-menu-item (click)="logout()">
    <mat-icon>logout</mat-icon>Logout
  </button>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="toggleTheme()">
    <mat-icon>{{
      themeService.isDarkMode() ? "light_mode" : "dark_mode"
    }}</mat-icon>
    <span>{{ themeService.isDarkMode() ? "Light Mode" : "Dark Mode" }}</span>
  </button>
</mat-menu>

<mat-menu #guestMenu="matMenu">
  <button mat-menu-item (click)="toggleTheme()">
    <mat-icon>{{
      themeService.isDarkMode() ? "light_mode" : "dark_mode"
    }}</mat-icon>
    <span>{{ themeService.isDarkMode() ? "Light Mode" : "Dark Mode" }}</span>
  </button>
</mat-menu>

<app-ai-chat-icon *ngIf="showAiChatIcon"></app-ai-chat-icon>
<app-ai-chat-window></app-ai-chat-window>
