<div *ngIf="isLoading">
  <app-loader></app-loader>
</div>

<div class="container">
  <mat-card class="login-card" role="region" aria-label="Sign in form">
    <mat-card-header>
      <mat-card-title>Sign In</mat-card-title>
      <mat-card-subtitle>
        Don’t have an account?
        <a class="sign-up-action" routerLink="/register">Sign up</a>
      </mat-card-subtitle>
      <div class="header-accent" aria-hidden="true"></div>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="loginForm" (ngSubmit)="onLogin()" novalidate>
        <!-- Email -->
        <div class="form-field">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Email</mat-label>
            <input
              matInput
              type="email"
              formControlName="email"
              required
              autocomplete="email"
              inputmode="email"
              aria-describedby="emailHint"
            />
            <mat-hint id="emailHint">Use your work email</mat-hint>
            <mat-error *ngIf="loginForm.get('email')?.hasError('required')">
              Email is required.
            </mat-error>
            <mat-error *ngIf="loginForm.get('email')?.hasError('email')">
              Enter a valid email.
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Password -->
        <div class="form-field">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Password</mat-label>
            <input
              matInput
              [type]="hidePassword ? 'password' : 'text'"
              formControlName="password"
              required
              autocomplete="current-password"
              aria-describedby="passwordHint"
            />
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="togglePasswordVisibility()"
              [attr.aria-label]="
                hidePassword ? 'Show password' : 'Hide password'
              "
              [attr.aria-pressed]="!hidePassword"
            >
              <mat-icon>{{
                hidePassword ? "visibility_off" : "visibility"
              }}</mat-icon>
            </button>
            <mat-hint id="passwordHint"
              >At least 10 chars, mixed case & symbol</mat-hint
            >
            <mat-error *ngIf="loginForm.get('password')?.hasError('required')">
              Password is required.
            </mat-error>
            <mat-error *ngIf="loginForm.get('password')?.hasError('minlength')">
              Password must be at least 10 characters long.
            </mat-error>
            <mat-error *ngIf="loginForm.get('password')?.hasError('pattern')">
              Must include uppercase, lowercase, and a special character.
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Secondary actions -->
        <div class="actions-row">
          <!-- <mat-checkbox>Remember me</mat-checkbox> -->
          <span></span>
          <div class="forgot-password-link">
            <a routerLink="/forgot-password">Forgot Password?</a>
          </div>
        </div>

        <!-- Primary action -->
        <button
          class="submit-btn"
          mat-flat-button
          type="submit"
          [disabled]="loginForm.invalid || isLoading"
        >
          {{ isLoading ? "Signing in…" : "Login" }}
        </button>

        <!-- Divider -->
        <mat-divider class="my-4"></mat-divider>

        <!-- Google Sign-In Button -->
        <div id="googleSignInDiv" class="google-btn-container"></div>
      </form>
    </mat-card-content>
  </mat-card>
</div>

<!-- Alert modal -->
<div
  *ngIf="showAlert"
  class="alert-overlay"
  role="dialog"
  aria-modal="true"
  aria-label="Notification"
>
  <div class="alert-modal">
    <p>{{ alertMessage }}</p>

    <div *ngIf="showResendLink">
      <div class="forgot-password-link-resend">
        <button type="button" class="link-button" (click)="resendEmail()">
          Resend Verification Email
        </button>
      </div>
    </div>

    <button
      class="submit-btn"
      mat-flat-button
      type="button"
      (click)="closeAlert()"
    >
      Close
    </button>
  </div>
</div>
