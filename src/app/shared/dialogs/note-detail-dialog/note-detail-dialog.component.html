<div class="note-dialog" role="dialog" aria-label="Note details">
  <!-- Header -->
  <header class="dialog-header">
    <h2 class="title">Note Details</h2>
    <span class="badge"
          [ngClass]="{
            'is-approved': getStatus(data.notes[0]) === 'Approved',
            'is-rejected': getStatus(data.notes[0]) === 'Rejected',
            'is-archived': getStatus(data.notes[0]) === 'Archived',
            'is-pending':  getStatus(data.notes[0]) === 'Pending'
          }">
      {{ getStatus(data.notes[0]) }}
    </span>
  </header>

  <!-- Body -->
  <mat-dialog-content class="dialog-body">
    <!-- Meta -->
    <dl class="meta-grid">
      <div class="meta-item">
        <dt>Project</dt>
        <dd>{{ data.projectName }}</dd>
      </div>
      <div class="meta-item">
        <dt>Subtask</dt>
        <dd>{{ data.subtaskName }}</dd>
      </div>
      <div class="meta-item">
        <dt>Created</dt>
        <dd>{{ data.createdAt | date:'medium' }}</dd>
      </div>
      <div class="meta-item">
        <dt>Status</dt>
        <dd>
          <span class="status-text">{{ getStatus(data.notes[0]) }}</span>
        </dd>
      </div>
    </dl>

    <!-- Messages -->
    <section class="messages">
      <h3 class="section-title">Messages</h3>
      <ul class="message-list">
        <li class="message" *ngFor="let note of data.notes">
          <div class="avatar" aria-hidden="true">
           <span class="avatar__text">{{ getInitials(getUserName(note.createdByUserId)) }}</span>
          </div>
          <div class="bubble">
            <div class="bubble-header">
              <span class="author">{{ getUserName(note.createdByUserId) }}</span>
              <span class="time">{{ note.createdAt | date:'short' }}</span>
            </div>
            <div class="bubble-text">
              {{ note.noteText }}
            </div>
          </div>
        </li>
      </ul>
    </section>

    <section *ngIf="data.notes[0].rejectionReason" class="rejection">
      <h3 class="section-title">Rejection Reason</h3>
      <p class="rejection-text">{{ data.notes[0].rejectionReason }}</p>
    </section>
  </mat-dialog-content>

  <!-- Actions -->
  <mat-dialog-actions class="dialog-actions" align="end">
    <button mat-flat-button class="btn btn-primary"
            *ngIf="authService.hasPermission('manageSubtaskNotes') && !data.isArchived"
            (click)="startApproval(data.notes[0])">
      Approve
    </button>

    <button mat-flat-button class="btn btn-danger"
            *ngIf="authService.hasPermission('manageSubtaskNotes') && !data.isArchived"
            (click)="rejectNote(data.notes[0])">
      Reject
    </button>

    <button mat-flat-button class="btn btn-neutral"
            *ngIf="(data.notes[0].approved || data.notes[0].rejected) &&
                   authService.hasPermission('manageSubtaskNotes') && !data.isArchived"
            (click)="archiveNote(data.notes[0])">
      Archive
    </button>

    <button mat-flat-button class="btn btn-ghost" (click)="openDocumentsDialog(data)">
      View Image
    </button>

    <button mat-flat-button class="btn btn-ghost" (click)="Close()">
      Close
    </button>
  </mat-dialog-actions>
</div>
