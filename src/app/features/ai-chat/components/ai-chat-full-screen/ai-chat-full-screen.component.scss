@use 'styles/util/mixins' as u;


@keyframes pulse-text {
  0% { opacity: .55; } 50% { opacity: 1; } 100% { opacity: .55; }
}

:host {
  display: flex;
  width: 100%;
  height: 100%;
  background: var(--color-canvas);
  color: var(--color-text);
}

/* Shell */
.full-screen-chat-container {
  display: flex;
  flex: 1;
  min-height: 0;
}

.conversations-list {
  min-width: 320px;
  max-width: 360px;
  border-right: 1px solid var(--color-border);
  display: flex;
  flex-direction: column;
  padding: var(--space-4);
  background: var(--color-surface);

  .conversation-list-header {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-3);

    .new-chat-btn { flex: 1; }

    .action-btn {
      background: transparent;
      border: 0;
      cursor: pointer;
      padding: 6px;
      color: var(--color-text);
      border-radius: var(--radius-sm);
      @include u.interactive-states;

      .material-icons { font-size: 22px; }
      &:hover { background: var(--color-surface-subtle); color: var(--color-accent); }
      &:focus-visible { outline: 0; box-shadow: 0 0 0 2px color-mix(in oklab, var(--color-primary) 60%, transparent); }
    }
  }

  .conversation-items { overflow: auto; }

  .conversation-item {
    position: relative;
    padding: var(--space-3);
    border-bottom: 1px solid var(--color-border);
    cursor: pointer;
    transition: background-color .15s ease;
    border-radius: var(--radius-sm);

    &:hover { background: var(--color-surface-hover); }

    &.active {
      background: color-mix(in oklab, var(--color-accent) 10%, transparent);
      border-inline-start: 4px solid var(--color-primary);
      padding-inline-start: calc(var(--space-3) - 4px);
    }

    .conversation-title-container {
      display: flex; justify-content: space-between; align-items: flex-start; gap: var(--space-3);
    }

    .conversation-title {
      font-weight: var(--fw-bold);
      margin: 0 0 4px 0;
      color: var(--color-text);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .conversation-timestamp {
      font-size: .85rem; color: var(--color-text-muted); white-space: nowrap; flex-shrink: 0;
    }

    .conversation-excerpt {
      font-size: .95rem; color: var(--color-text-muted);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
  }
}

.edit-icon {
  cursor: pointer;
  font-size: 18px;
  visibility: hidden;
  color: var(--color-text);
  position: absolute; right: 1rem; top: 1rem;
  background: var(--color-surface);
  border-radius: 50%; padding: 4px;
  width: 26px; height: 26px;
  display: grid; place-items: center;
  box-shadow: var(--shadow-1);

  &:hover { color: var(--color-accent); }
}
.conversation-item:hover .edit-icon { visibility: visible; }

.edit-container {
  display: flex; align-items: center; width: 100%; gap: var(--space-2);

  .edit-input {
    flex: 1; padding: 6px 10px;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    color: var(--color-text);
    &:focus { outline: 0; border-color: var(--color-primary);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--color-primary) 22%, transparent); }
  }

  .edit-actions {
    display: inline-flex; align-items: center; gap: 2px;

    .save-button  { color: var(--color-success); }
    .cancel-button{ color: var(--color-danger); }

    button {
      border: 0; background: transparent; padding: 6px; border-radius: var(--radius-sm);
      @include u.interactive-states;
      &:hover { background: var(--color-surface-subtle); }
    }
  }
}

.chat-area {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-width: 0;
  background: var(--color-canvas);
  position: relative;

  .scroll-wrapper { flex: 1; position: relative; min-height: 0; }
  .chat-window-container {
    position: absolute; inset: 0; overflow: auto; padding-bottom: var(--space-6);
  }

  .message-history {
    padding: var(--space-4);
    display: flex; flex-direction: column; gap: var(--space-2);

    .message {
      display: flex; align-items: flex-start; gap: var(--space-3);
      padding: .5rem 1rem;
      border-radius: 16px;
      margin-bottom: .25rem;
      max-width: min(720px, 75%);
      box-shadow: 0 1px 2px rgba(0,0,0,.04);

      .chat-icon {
        flex-shrink: 0;
        width: 28px; height: 28px;
        border-radius: 50%;
        background: var(--color-primary);
        display: grid; place-items: center;
        color: var(--color-text-inverse) !important;
      }

      .message-content { flex: 1; }

      &.user {
        align-self: flex-end;
        background: var(--color-primary);
        color: var(--color-text-inverse) !important;
        border-bottom-right-radius: 6px;
      }

      &.ai {
        align-self: flex-start;
        background: var(--color-surface);
        color: var(--color-text);
        border: 1px solid var(--color-border);
        border-bottom-left-radius: 6px;

        p.loading { animation: pulse-text 1.5s infinite; }
      }
    }

    .user-prompt { color: var(--color-text-inverse) !important; white-space: pre-wrap; }
  }

  .message-input-container {
    position: sticky; bottom: 0; z-index: 2;
    padding: var(--space-4);
    border-top: 1px solid var(--color-border);
    background: var(--color-surface);

    form {
      display: flex; align-items: flex-end; gap: var(--space-2);

      input, textarea {
        flex: 1;
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 20px;
        color: var(--color-text);
        padding: .75rem 1rem;
        resize: none; overflow-y: hidden;
        transition: border-color .15s ease, box-shadow .15s ease;
        &:focus { outline: 0; border-color: var(--color-primary);
          box-shadow: 0 0 0 3px color-mix(in oklab, var(--color-primary) 22%, transparent); }
        &:disabled { cursor: not-allowed; }
      }

      button { gap: .5rem; }
    }
  }

  .upload-progress, .upload-complete {
    margin-bottom: var(--space-3);
    p { margin: 0; font-size: .95rem; }
  }
  .upload-progress p { color: var(--color-text); }
  .upload-complete p { color: var(--color-success); }

  .welcome-screen {
    height: 100%; display: grid; place-content: center; text-align: center; gap: var(--space-4);

    h2 { font-size: 2rem; margin: 0; color: var(--color-text); }

    .prompt-selection {
      width: 100%; max-width: 1400px; margin-top: var(--space-4);

      h3 { color: var(--color-text); margin: 0; }

      .prompt-buttons {
        margin-top: var(--space-3);
        display: flex; flex-wrap: wrap; gap: var(--space-3); justify-content: center;
      }

      button {
        height: 5rem; width: 12rem; padding: .5rem;
        display: inline-flex; align-items: center; justify-content: center;
        text-align: center; white-space: normal;
        border-radius: var(--radius-md);
        border: 1px solid var(--color-border);
        background: var(--color-surface);
        @include u.interactive-states;

        &:hover { background: var(--color-surface-subtle); }
      }
    }
  }
}

.submit-btn {
  background: var(--color-primary);
  color: var(--color-text-inverse) !important;
  border-radius: var(--radius-md);
  padding: 8px 16px;
  font-weight: var(--fw-semibold);
  border: 0;
  @include u.interactive-states;

  &:hover { background: var(--color-primary-hover); }
  &.publish-btn { background: var(--color-primary); }
  &.save-btn { background: var(--color-accent); color: var(--color-text-inverse) !important; }
}
.send-button[disabled] { background: #ccc; cursor: not-allowed; }

.more-options-btn {
  background: transparent; border: 0; color: var(--color-text);
  font-size: 1.5rem; padding: 0 .5rem; align-self: center; cursor: pointer; border-radius: var(--radius-sm);
  @include u.interactive-states;

  &:hover { color: var(--color-primary); background: var(--color-surface-subtle); }
}

.prompts-popup {
  position: absolute; left: 1rem; bottom: 80px; z-index: 100;
  width: calc(100% - 2rem); max-height: 320px; overflow: auto;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-2, 0 8px 24px rgba(0,0,0,.08));
  padding: var(--space-4);

  .prompt-item {
    padding: .75rem; border-bottom: 1px solid var(--color-border);
    cursor: pointer; transition: background-color .15s ease; border-radius: var(--radius-sm);

    &:hover { background: var(--color-surface-hover); }

    .prompt-title { font-weight: var(--fw-bold); color: var(--color-text); }
    .prompt-description { font-size: .95rem; color: var(--color-text-muted); margin-top: .25rem; }
  }
}

.selected-prompt-display {
  position: sticky; top: 0; z-index: 2;
  background: var(--color-surface-subtle);
  padding: var(--space-4);
  margin: var(--space-4);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);

  h2 { margin: 0 0 var(--space-2) 0; font-size: 1.1rem; font-weight: var(--fw-semibold); color: var(--color-text); }
  ul { list-style: none; margin: 0; padding: 0; }
  li { margin-bottom: .5rem; font-size: .95rem; color: var(--color-text-muted); }
}

.button-wrapper { display: inline-block; }
.disabled-wrapper { cursor: not-allowed; }
.disabled-wrapper .submit-btn { background: #ccc; color: #666; pointer-events: none; }

.icon-button {
  min-width: 0; padding: 0; width: 40px; height: 40px;
  display: inline-flex; align-items: center; justify-content: center;
  border-radius: var(--radius-sm);
  @include u.interactive-states;

  .mat-icon { margin: 0; }
}

@media (max-width: 1024px) {
  .conversations-list { min-width: 280px; max-width: 300px; }
}
@media (max-width: 768px) {
  .conversations-list { display: none; } 
  .chat-area .message { max-width: 100% !important; }
}
@media (prefers-reduced-motion: reduce) {
  * { animation: none !important; transition: none !important; }
}
