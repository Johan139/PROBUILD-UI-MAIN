<div *ngIf="isChatOpen$ | async" class="chat-window">
  <header class="chat-header">
    <h2 class="chat-title">AI Assistant</h2>
    <div class="header-actions">
      <button (click)="goToFullScreen()" class="action-btn" aria-label="Full screen">
        <span class="material-icons">fullscreen</span>
      </button>
      <button (click)="closeChat()" class="action-btn" aria-label="Close chat">
        <span class="material-icons">close</span>
      </button>
    </div>
  </header>

  <main class="chat-messages">
    <div *ngFor="let message of messages$ | async" class="message" [ngClass]="{ 'user-message': message.Role === 'user', 'ai-message': message.Role === 'model' }">
      <p>{{ message.Content }}</p>
    </div>
    <div *ngIf="isLoading$ | async" class="loading-indicator">
      <span></span><span></span><span></span>
    </div>
  </main>

  <footer class="chat-input-area">
   <div *ngIf="isUploading" class="upload-progress">
     <p>Upload Progress: {{ progress }}%</p>
     <mat-progress-bar mode="determinate" [value]="progress"></mat-progress-bar>
   </div>
   <div *ngIf="!isUploading && uploadedFileInfos.length > 0" class="upload-complete">
     <p [matTooltip]="getUploadedFileNames()" matTooltipPosition="above">
       {{ uploadedFileInfos.length }} file(s) uploaded successfully
     </p>
   </div>
    <form #form="ngForm" (ngSubmit)="sendMessage(form.value); form.reset()" class="chat-form">
      <input type="file" #fileInput style="display: none" (change)="onFileSelected($event)" multiple />
      <input type="file" #folderInput style="display: none" (change)="onFileSelected($event)" webkitdirectory multiple />

      <button type="button" class="attach-btn" (click)="onAttachFile()">
      <span class="material-icons">attach_file</span>
      </button>
      <button type="button" class="attach-btn" (click)="viewUploadedFiles()">
      <span class="material-icons">folder</span>
      </button>
      <textarea
        name="message"
        ngModel
        placeholder="Type your message..."
        class="chat-input"
        rows="1"
        (keydown.enter)="sendMessage(form.value); form.reset(); $event.preventDefault()"
      ></textarea>
      <button type="submit" class="send-btn" [disabled]="!form.value.message || (isLoading$ | async)">
        <span class="material-icons">send</span>
      </button>
    </form>
  </footer>
</div>
