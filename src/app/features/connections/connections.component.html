<div class="connections-container">
  <h1>User Directory</h1>

  <mat-card>
    <mat-card-content>
      <mat-form-field appearance="fill">
        <mat-label>Search for users</mat-label>
        <input matInput [(ngModel)]="searchTerm" (keyup.enter)="searchUsers()" placeholder="e.g., John Doe, Electrician">
        <button mat-icon-button matSuffix (click)="searchUsers()">
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>
    </mat-card-content>
  </mat-card>

  <mat-tab-group>
    <mat-tab label="Search Results">
      <ng-template matTabContent>
        <table mat-table [dataSource]="searchResults" class="mat-elevation-z8">

          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Name </th>
            <td mat-cell *matCellDef="let user"> {{user.firstName}} {{user.lastName}} </td>
          </ng-container>

          <!-- User Type Column -->
          <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef> Type </th>
            <td mat-cell *matCellDef="let user"> {{user.userType}} </td>
          </ng-container>

          <!-- Company Name Column -->
          <ng-container matColumnDef="companyName">
            <th mat-header-cell *matHeaderCellDef> Company </th>
            <td mat-cell *matCellDef="let user"> {{user.companyName}} </td>
          </ng-container>

          <!-- Email Column -->
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef> Email </th>
            <td mat-cell *matCellDef="let user"> {{user.email}} </td>
          </ng-container>

          <!-- Phone Number Column -->
          <ng-container matColumnDef="phoneNumber">
            <th mat-header-cell *matHeaderCellDef> Phone </th>
            <td mat-cell *matCellDef="let user"> {{user.phoneNumber}} </td>
          </ng-container>

          <!-- Construction Type Column -->
          <ng-container matColumnDef="constructionType">
            <th mat-header-cell *matHeaderCellDef> Construction Type </th>
            <td mat-cell *matCellDef="let user"> {{user.constructionType}} </td>
          </ng-container>

          <!-- Trade Column -->
          <ng-container matColumnDef="trade">
            <th mat-header-cell *matHeaderCellDef> Trade </th>
            <td mat-cell *matCellDef="let user"> {{user.trade}} </td>
          </ng-container>

          <!-- Supplier Type Column -->
          <ng-container matColumnDef="supplierType">
            <th mat-header-cell *matHeaderCellDef> Supplier Type </th>
            <td mat-cell *matCellDef="let user"> {{user.supplierType}} </td>
          </ng-container>

          <!-- Products Offered Column -->
          <ng-container matColumnDef="productsOffered">
            <th mat-header-cell *matHeaderCellDef> Products Offered </th>
            <td mat-cell *matCellDef="let user"> {{user.productsOffered}} </td>
          </ng-container>

          <!-- Country Column -->
          <ng-container matColumnDef="country">
            <th mat-header-cell *matHeaderCellDef> Country </th>
            <td mat-cell *matCellDef="let user"> {{user.country}} </td>
          </ng-container>

          <!-- City Column -->
          <ng-container matColumnDef="city">
            <th mat-header-cell *matHeaderCellDef> City </th>
            <td mat-cell *matCellDef="let user"> {{user.city}} </td>
          </ng-container>

          <!-- Action Column -->
          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let user">
              <button *ngIf="user.id !== currentUserId" mat-stroked-button color="primary" (click)="sendConnectionRequest(user.id)">
                <mat-icon>person_add</mat-icon>
                Connect
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        <p *ngIf="searchResults.length === 0">No users found</p>
      </ng-template>
    </mat-tab>

    <mat-tab label="My Connections">
      <ng-template matTabContent>
        <mat-list>
          <mat-list-item *ngFor="let conn of connections">
            <h3 matLine>{{ conn.requester?.firstName }} {{ conn.requester?.lastName }}</h3>
            <p matLine>Connected</p>
          </mat-list-item>
        </mat-list>
      </ng-template>
    </mat-tab>

    <mat-tab label="Incoming Requests">
      <ng-template matTabContent>
        <mat-list>
          <mat-list-item *ngFor="let req of incomingRequests">
            <h3 matLine>{{ req.requester?.firstName }} {{ req.requester?.lastName }}</h3>
            <p matLine>Wants to connect with you</p>
            <button mat-stroked-button color="primary" (click)="acceptConnectionRequest(req.id)">Accept</button>
            <button mat-stroked-button color="warn" (click)="declineConnectionRequest(req.id)">Decline</button>
          </mat-list-item>
        </mat-list>
      </ng-template>
    </mat-tab>

    <mat-tab label="Outgoing Requests">
      <ng-template matTabContent>
        <mat-list>
          <mat-list-item *ngFor="let req of outgoingRequests">
            <h3 matLine>{{ req.receiver?.firstName }} {{ req.receiver?.lastName }}</h3>
            <p matLine>Request sent</p>
          </mat-list-item>
        </mat-list>
      </ng-template>
    </mat-tab>
  </mat-tab-group>
</div>

